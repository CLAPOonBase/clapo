<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Connection Test</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
</head>
<body>
    <h1>üîç Contract Connection Test</h1>
    <div id="results"></div>
    
    <script>
        const resultsDiv = document.getElementById('results');
        
        function log(message) {
            console.log(message);
            resultsDiv.innerHTML += `<p>${message}</p>`;
        }
        
        async function testContractConnection() {
            log("üîç Testing Contract Connection...");
            
            // Check if MetaMask is available
            if (typeof window.ethereum === 'undefined') {
                log("‚ùå MetaMask not detected");
                return;
            }
            
            log("‚úÖ MetaMask detected");
            
            try {
                // Request account access
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                log(`‚úÖ Connected account: ${accounts[0]}`);
                
                // Check network
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                log(`Current chain ID: ${chainId}`);
                
                if (chainId === '0x2797') {
                    log("‚úÖ Connected to Monad Testnet");
                } else {
                    log("‚ùå Not connected to Monad Testnet");
                    log("Expected chain ID: 0x2797 (10143)");
                    log("Please switch to Monad Testnet in MetaMask");
                    return;
                }
                
                // Create provider and signer
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                
                // Contract configuration
                const CONTRACT_ADDRESS = "0xAb6E048829A7c7Cc9b9C5f31cb445237F2b2dC7e";
                const contractABI = [
                    "function owner() external view returns (address)",
                    "function paused() external view returns (bool)",
                    "function doesUuidExist(string memory uuid) external view returns (bool)",
                    "function getAllPosts() external view returns (tuple(uint256 postId, string uuid, string content, string imageUrl, address creator, uint256 createdAt, bool exists)[] memory)"
                ];
                
                // Create contract instance
                const contract = new ethers.Contract(CONTRACT_ADDRESS, contractABI, signer);
                
                log("‚úÖ Contract instance created");
                
                // Test contract functions
                const owner = await contract.owner();
                log(`‚úÖ Contract owner: ${owner}`);
                
                const isPaused = await contract.paused();
                log(`‚úÖ Contract paused: ${isPaused}`);
                
                // Test specific post
                const postId = "426cdfa2-ed23-44f7-a561-c6053a6be6c3";
                const uuid = `post-${postId}`;
                
                const exists = await contract.doesUuidExist(uuid);
                log(`‚úÖ Post ${postId} exists: ${exists}`);
                
                if (exists) {
                    log("üéâ Frontend can access the token!");
                } else {
                    log("‚ùå Frontend cannot access the token");
                }
                
                // Get all posts
                const allPosts = await contract.getAllPosts();
                log(`‚úÖ Total posts in contract: ${allPosts.length}`);
                
                if (allPosts.length > 0) {
                    log("Posts found:");
                    allPosts.forEach((post, index) => {
                        log(`  Post ${index + 1}: ${post.uuid} - ${post.content.substring(0, 30)}...`);
                    });
                }
                
                log("üéâ Contract connection test completed successfully!");
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                console.error("Full error:", error);
            }
        }
        
        // Run the test when page loads
        window.addEventListener('load', testContractConnection);
    </script>
</body>
</html>
