# Cloud Run + Cloud Build Auto-Deploy Setup for Next.js Frontend

## Files to Create

### 1. Dockerfile
```dockerfile
FROM node:20-alpine

WORKDIR /app

COPY package*.json ./
COPY pnpm-lock.yaml ./

RUN npm install -g pnpm
RUN pnpm install --no-frozen-lockfile

COPY . .

RUN pnpm run build

EXPOSE 8080

ENV PORT=8080
ENV HOSTNAME=0.0.0.0

CMD ["pnpm", "start"]
```

### 2. cloudbuild.yaml
```yaml
steps:
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/clapo-fe', '.']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/$PROJECT_ID/clapo-fe']
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: gcloud
    args:
      ['run', 'deploy', 'clapo-fe', '--image', 'gcr.io/$PROJECT_ID/clapo-fe', '--region', 'asia-south1', '--platform', 'managed', '--allow-unauthenticated', '--port', '8080']
images:
  - 'gcr.io/$PROJECT_ID/clapo-fe'
```

### 3. README.md
```markdown
# Clapo Frontend - Google Cloud Run Deployment

## Quick Deploy
```bash
gcloud run deploy clapo-fe --source . --region asia-south1 --allow-unauthenticated
```

## Setup Commands

```bash
gcloud services enable run.googleapis.com
gcloud services enable cloudbuild.googleapis.com
gcloud services enable containerregistry.googleapis.com
```

## Build Commands

```bash
pnpm install
pnpm run build
pnpm start
```

## Deploy Commands

```bash
gcloud run deploy clapo-fe --source . --region asia-south1 --allow-unauthenticated
gcloud run deploy clapo-fe --image gcr.io/seraphic-heaven-476106-p6/clapo-fe --region asia-south1 --allow-unauthenticated
```

## Cloud Build (Auto Deploy)

```bash
gcloud builds submit --config cloudbuild.yaml
gcloud builds triggers create github --repo-name=your-repo --repo-owner=your-username --branch-pattern=main --build-config=cloudbuild.yaml
```

## Check Status

```bash
gcloud run services list
gcloud run services describe clapo-fe --region asia-south1
```

## Test

```bash
curl https://clapo-fe-xyz.a.run.app
```

## URLs

- Service: https://clapo-fe-xyz.a.run.app
- Custom Domain: https://clapo.blazeswap.io (after DNS setup)

## Files Created

- Dockerfile (container config)
- cloudbuild.yaml (auto deploy config)
- README.md (this file)

## DNS Setup

```
CNAME: clapo -> clapo-fe-xyz.a.run.app
```
```

## Setup Commands

### 1. Enable Services
```bash
gcloud services enable run.googleapis.com
gcloud services enable cloudbuild.googleapis.com
gcloud services enable containerregistry.googleapis.com
```

### 2. Deploy Once (Manual)
```bash
gcloud run deploy clapo-fe --source . --region asia-south1 --allow-unauthenticated
```

### 3. Test Cloud Build
```bash
gcloud builds submit --config cloudbuild.yaml
```

### 4. Create GitHub Trigger (Manual Setup)
Go to Google Cloud Console:
1. Cloud Build → Triggers → Create Trigger
2. Connect GitHub repository
3. Select branch: main
4. Build configuration: Cloud Build YAML
5. Location: cloudbuild.yaml

### 5. Check Status
```bash
gcloud run services list
gcloud run services describe clapo-fe --region asia-south1
```

## Project Info
- Project ID: seraphic-heaven-476106-p6
- Region: asia-south1 (same as backend)
- Service Name: clapo-fe
- GitHub: YappOnSei/CLAPO-FE

## Notes
- Uses pnpm (not npm)
- Port 8080 for Cloud Run
- Auto-deploys on every push to main branch
- Same region as backend for low latency
















